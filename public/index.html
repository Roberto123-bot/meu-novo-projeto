<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Combina√ß√µes</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        padding: 20px;
        background: #f4f4f9;
        color: #333;
        max-width: 600px;
        margin: 20px auto;
      }
      h1 {
        text-align: center;
        color: #4a4a4a;
      }
      form {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      #nome {
        grid-column: 1 / -1;
      }
      input,
      button {
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        /* Adicionado para os inputs de n√∫mero n√£o diminuirem */
        min-width: 0;
      }
      button[type="submit"] {
        grid-column: 1 / -1;
        background: #007aff;
        color: white;
        font-weight: bold;
        cursor: pointer;
        border: none;
      }
      button[type="submit"]:hover {
        background: #0056b3;
      }
      #copyButton {
        display: block;
        width: 100%;
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        background: #28a745;
        color: white;
        font-weight: bold;
        cursor: pointer;
        margin-bottom: 20px;
      }
      #copyButton:hover {
        background: #218838;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        background: white;
        padding: 15px;
        margin-bottom: 8px;
        border-radius: 6px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.1em;
        /* Quebra de linha para nomes muito longos */
        word-break: break-word;
      }
      li strong {
        color: #007aff;
      }
      li span {
        font-family: monospace, monospace;
        font-size: 1.2em;
        font-weight: bold;
        padding-left: 10px; /* Garante um espa√ßo */
      }
      .admin-buttons {
        display: flex;
        gap: 8px;
        padding-left: 10px; /* Garante um espa√ßo */
      }
      .admin-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        padding: 5px;
      }
      .edit-btn {
        color: #ffc107;
      }
      .delete-btn {
        color: #dc3545;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 8px;
        width: 80%;
        max-width: 500px;
      }
      #editForm {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
      }
      #editNome {
        grid-column: 1 / -1;
      }
      #saveEditButton {
        grid-column: 1 / -1;
      }
      #closeModalButton {
        background-color: #aaa;
        grid-column: 1 / -1;
      }

      /* --- NOVO CSS (Responsivo para Celular) --- */
      @media (max-width: 500px) {
        body {
          /* Remove a margem e padding laterais */
          margin: 0;
          padding: 10px;
        }

        /* Muda os formul√°rios para 1 coluna */
        form,
        #editForm {
          grid-template-columns: 1fr;
        }

        li {
          /* Permite que o item da lista quebre a linha */
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }

        .admin-buttons {
          /* Coloca os bot√µes de admin no final */
          align-self: flex-end;
        }
      }
      /* --- FIM DO NOVO CSS --- */
    </style>
  </head>
  <body>
    <h1>üí° Lista de Combina√ß√µes</h1>

    <form id="form">
      <input type="text" id="nome" placeholder="Seu nome" required />
      <input type="number" id="n1" min="1" max="60" placeholder="N1" required />
      <input type="number" id="n2" min="1" max="60" placeholder="N2" required />
      <input type="number" id="n3" min="1" max="60" placeholder="N3" required />
      <button type="submit">Salvar</button>
    </form>

    <button id="copyButton">Copiar Lista</button>
    <ul id="lista"></ul>

    <div id="editModal" class="modal">
      <div class="modal-content">
        <h2>Editar Combina√ß√£o</h2>
        <form id="editForm">
          <input type="hidden" id="editId" />
          <input type="text" id="editNome" placeholder="Seu nome" required />
          <input
            type="number"
            id="editN1"
            min="1"
            max="60"
            placeholder="N1"
            required
          />
          <input
            type="number"
            id="editN2"
            min="1"
            max="60"
            placeholder="N2"
            required
          />
          <input
            type="number"
            id="editN3"
            min="1"
            max="60"
            placeholder="N3"
            required
          />
          <button type="submit" id="saveEditButton">Salvar Mudan√ßas</button>
          <button type="button" id="closeModalButton">Cancelar</button>
        </form>
      </div>
    </div>

    <script>
      // Lembre de trocar pela sua URL do Railway
      const backendURL = "https://meu-novo-projeto-production.up.railway.app";

      let dadosAtuais = [];
      const socket = io(backendURL);
      const listaEl = document.getElementById("lista");
      const formEl = document.getElementById("form");
      const copyButton = document.getElementById("copyButton");

      const editModal = document.getElementById("editModal");
      const editForm = document.getElementById("editForm");
      const closeModalButton = document.getElementById("closeModalButton");

      // --- PARTE A: Receber dados (Socket.io) ---
      socket.on("update", (dados) => {
        dados.reverse(); // <<<--- ADICIONE ESTA LINHA

        dadosAtuais = dados;
        listaEl.innerHTML = "";

        dados.forEach((item) => {
          const li = document.createElement("li");

          li.dataset.id = item.id;
          li.dataset.nome = item.nome;
          li.dataset.n1 = item.n1;
          li.dataset.n2 = item.n2;
          li.dataset.n3 = item.n3;

          li.innerHTML = `
            <div>
              <strong>${item.nome}</strong> 
              <br>
              <span>${item.n1}, ${item.n2}, ${item.n3}</span>
            </div>
            <div class="admin-buttons">
              <button class="admin-btn edit-btn">‚úèÔ∏è</button>
              <button class="admin-btn delete-btn">‚ùå</button>
            </div>
          `;
          listaEl.appendChild(li);
        });
      });

      // --- PARTE B: Envio de Formul√°rio (POST) ---
      formEl.addEventListener("submit", async (e) => {
        e.preventDefault();
        const nome = document.getElementById("nome").value;
        const n1 = document.getElementById("n1").value;
        const n2 = document.getElementById("n2").value;
        const n3 = document.getElementById("n3").value;

        await fetch(backendURL + "/combinacoes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ nome, n1, n2, n3 }),
        });
        formEl.reset();
      });

      // --- PARTE C: L√≥gica de Copiar ---
      copyButton.addEventListener("click", () => {
        if (dadosAtuais.length === 0) {
          copyButton.innerText = "Lista vazia!";
          setTimeout(() => (copyButton.innerText = "Copiar Lista"), 2000);
          return;
        }

        const titulo = `(‚óûÍàç‚àáÍàç)„Å£üéÅ ùô±ùöÅùô∏ùôΩùô≤ùô∞ùô≥ùô¥ùô∏ùöÅùô∞ùöÇ ùô≥ùô∞ùöÇ ùôµùô∞ùôªùô∑ùô∞ùöÇ (‚ùõ0‚ùõ‚ãÜ)

üéØùêÄùêúùêûùê´ùê≠ùêû ùüë ùêùùêûùê≥ùêûùêßùêöùê¨ ùê™ùêÆùêû ùêß√£ùê® ùê¢ùê´√£ùê® ùêØùê¢ùê¶ ùêßùêö ùê•ùê®ùê≠ùê®ùêüùêöùêúùê¢ùê• ùê°ùê®ùê£ùêû ùüëùüìùüèùüì

üéÅùêÜùêÄùêçùêáùêÄ ùüèùüéùüé ùêÅùêàùêãùêáùêÑùêìùêÑùêí ùêÉùêÄ ùêëùêàùêÖùêÄ ùêÑ ùêåùêÄùêàùêí ùüí ùêèùêàùêó ùêèùêÑùêãùêÄ ùêãùêéùêìùêÑùêëùêàùêÄ ùêÖùêÑùêÉùêÑùêëùêÄùêã

`;

        // --- MUDAN√áA DA FORMATA√á√ÉO DA LISTA ---
        const listaFormatada = dadosAtuais
          .map((item, index) => {
            // "index" come√ßa em 0, ent√£o adicionamos 1
            const numero = index + 1;
            // Adicionamos o n√∫mero e um ponto antes do nome
            return `${numero}. ${item.nome}:\t${item.n1}, ${item.n2}, ${item.n3}`;
          })
          .join("\n");
        // --- FIM DA MUDAN√áA ---

        navigator.clipboard.writeText(titulo + listaFormatada).then(() => {
          copyButton.innerText = "Copiado! üëç";
          setTimeout(() => {
            copyButton.innerText = "Copiar Lista";
          }, 2000);
        });
      });

      // --- PARTE D: L√ìGICA DE ADMIN (EDITAR E DELETAR) ---
      function getAdminPassword() {
        return prompt("Digite a senha de Admin:");
      }

      listaEl.addEventListener("click", async (e) => {
        const target = e.target;
        const li = target.closest("li");
        if (!li) return;

        const id = li.dataset.id;

        // Deletar
        if (target.classList.contains("delete-btn")) {
          if (!confirm(`Tem certeza que quer deletar "${li.dataset.nome}"?`)) {
            return;
          }
          const password = getAdminPassword();
          if (!password) return;

          try {
            const res = await fetch(`${backendURL}/combinacoes/${id}`, {
              method: "DELETE",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ adminPassword: password }),
            });
            if (!res.ok) alert("Senha incorreta ou erro no servidor.");
          } catch (err) {
            alert("Erro ao deletar.");
          }
        }

        // Editar (Abrir Modal)
        if (target.classList.contains("edit-btn")) {
          document.getElementById("editId").value = id;
          document.getElementById("editNome").value = li.dataset.nome;
          document.getElementById("editN1").value = li.dataset.n1;
          document.getElementById("editN2").value = li.dataset.n2;
          document.getElementById("editN3").value = li.dataset.n3;
          editModal.style.display = "block";
        }
      });

      // Fechar Modal
      closeModalButton.addEventListener("click", () => {
        editModal.style.display = "none";
      });
      window.addEventListener("click", (e) => {
        if (e.target == editModal) {
          editModal.style.display = "none";
        }
      });

      // Salvar Edi√ß√£o
      editForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const password = getAdminPassword();
        if (!password) return;

        const id = document.getElementById("editId").value;
        const dados = {
          nome: document.getElementById("editNome").value,
          n1: document.getElementById("editN1").value,
          n2: document.getElementById("editN2").value,
          n3: document.getElementById("editN3").value,
          adminPassword: password,
        };

        try {
          const res = await fetch(`${backendURL}/combinacoes/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(dados),
          });
          if (!res.ok) {
            alert("Senha incorreta ou erro ao salvar.");
          } else {
            editModal.style.display = "none";
          }
        } catch (err) {
          alert("Erro ao salvar.");
        }
      });
    </script>
  </body>
</html>
